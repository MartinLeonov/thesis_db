<html>

  <!-- NOTE!!! Chromium has to be run with flags: --args --disable-web-security --allow-file-access-from-files  -->

  <head>
    <meta charset="ISO-8859-1">

    <style>
      #thesis_list td
        {
          border: 1px solid black;
          padding: 5px;
        }

      #thesis_list
        {
          border-collapse: collapse;
        }

      a
        {
          text-decoration: none;
        }

      input[type="number"]
        {
          width: 60px;
        }

      form
        {
          font-size: 10px;
          background-color: rgb(0,0,0);
          padding: 20px;
          border-radius: 10px;
          margin: 30px;
        }

      form table
        {
          border-collapse: collapse;
          table-layout: fixed;
          width: 100%;
          color: white;
        }

      form table td
        {
          padding: 3px 0;
        }

      .tab
        {
          display: inline-block;
          width: 100px;
          height: 30px;
          padding: 0;
          margin: 0;
        }

       .search
        {
          width: 100%;
          height: 30px;
          font-weight: bold;
        }

    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script>
      theses = null;

      function person_to_string(person)
        {
          result = "";

          for (i in person.degrees)
            result += person.degrees[i] + " ";

          result += person.name_first + " " + person.name_last;

          return result;
        }

      function to_str(thing)
        {
          if (thing == null) 
            return "";

          return "" + thing;
        }

      function sort_theses(thesis_list)
        {
          sort_by = $("select[name=sort_by]").val();

          desc = checkbox_checked("do_descending");

          sort_year = function(a,b)
            {
              if (!desc)
                return (a.year == null ? 0 : a.year) - (b.year == null ? 0 : b.year);
              
              return (b.year == null ? 0 : b.year) - (a.year == null ? 0 : a.year); 
            };

          sort_title = function(a,b)
            {
              s1 = ("" + a.title_cs).toLowerCase();
              s2 = ("" + b.title_cs).toLowerCase();

              if (desc)
                return s2.localeCompare(s1);  

              return s1.localeCompare(s2);  
            };

          sort_author = function(a,b)
            {
              s1 = ("" + a.author.name_last + a.author.name_first).toLowerCase();
              s2 = ("" + b.author.name_last + a.author.name_first).toLowerCase();

              if (desc)
                return s2.localeCompare(s1);  

              return s1.localeCompare(s2);  
            };

          if (sort_by == 0)
            sort_func = sort_year;
          else if (sort_by == 1)
            sort_func = sort_title;
          else
            sort_func = sort_author;

          thesis_list.sort(sort_func);

          return thesis_list;

          //return thesis_list;
        }

      function display_thesis_list(thesis_list)
        {
          $("#thesis_list").empty();

          for (i in thesis_list)
            {
              t = thesis_list[i];

              table_row = "<tr> " +
                "<td>" + to_str(t.degree) + "</td>" +
                "<td>" + to_str(t.faculty) + "</td>" +
                "<td>" + to_str(t.language) + "</td>" +
                "<td>" + person_to_string(t.author) + "</td>" +
                "<td>" + person_to_string(t.supervisor) + "</td>" +
                "<td>" + to_str(t.grade) + "</td>" +
                "<td> <a href=\"" + t.url_page + "\">" +  (t.title_cs != null ? t.title_cs : t.tile_en) + "</a> </td>";

              if (t.url_fulltext != null)
                table_row += "<td> <a href=\"" + t.url_fulltext + "\"> full </a> </td>"
              else
                table_row += "<td> </td>"

              table_row += "<td>" + to_str(t.year) + "</td>" +
                "<td>" + to_str(t.pages) + "</td>" +
                "</tr>";

              $("#thesis_list").append(table_row);
            }
        }

      $.getJSON("theses.json", function(json)
        {
          theses = json;
        });

      function input_value(input_name)
        {
          return $("input[name=" + input_name + "]").val();
        }

      function checkbox_checked(checkbox_name)
        {
          return $("input[name=" + checkbox_name + "]").is(":checked");
        }

      function meets_criteria(thesis)
        {

          if (!checkbox_checked("do_bachelor") && thesis.kind == "bachelor")
            return false;

          if (!checkbox_checked("do_master") && thesis.kind == "master")
            return false;

          if (!checkbox_checked("do_dr") && thesis.kind == "small doctorate")
            return false;

          if (!checkbox_checked("do_phd") && thesis.kind == "PhD")
            return false;

          if (!checkbox_checked("do_doc") && thesis.kind == "habilitation")
            return false;

          if (!checkbox_checked("do_grade_unknown") && thesis.grade == null)
            return false;

          if (thesis.grade == "A" && !checkbox_checked("do_a"))
            return false;

          if (thesis.grade == "B" && !checkbox_checked("do_b"))
            return false;

          if (thesis.grade == "C" && !checkbox_checked("do_c"))
            return false;

          if (thesis.grade == "D" && !checkbox_checked("do_d"))
            return false;

          if (thesis.grade == "E" && !checkbox_checked("do_e"))
            return false;

          if (thesis.grade == "F" && !checkbox_checked("do_f"))
            return false;

          if (thesis.language == null && !checkbox_checked("do_lang_unknown"))
            return false;

          if (thesis.language == "cs" && !checkbox_checked("do_cs"))
            return false;

          if (thesis.language == "sk" && !checkbox_checked("do_sk"))
            return false;
          
          if (thesis.language == "en" && !checkbox_checked("do_en"))
            return false;
          
          return true;
        }

      function search_clicked()
        {
          result = [];

          for (i in theses)
            {
              if (meets_criteria(theses[i]))
                result.push(theses[i]);
            }

          display_thesis_list(sort_theses(result));
        }

    </script>

  </head>

  <body>

    <h1> Czech Computer Science Theses </h1>

    <form>
      <table>
        <tr>
          <td colspan="3"> search for: <input type="text" name="search_for"> </td>
          <td colspan="3"> max results: <input type="number" name="max_results" value="50"> </td>
          <td colspan="2">
            sort by
            <select name="sort_by">
              <option value="0"> year </option>
              <option value="1"> title </option>
              <option value="2"> author </option>
            </select>
          </td>
          <td> <input type="checkbox" name="do_descending" checked="checked"> desc. </td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> search </td>
          <td> <input type="checkbox" name="do_title" checked="checked"> in title </td>
          <td> <input type="checkbox" name="do_names" checked="checked"> in names </td>
          <td> <input type="checkbox" name="do_keywords" checked="checked"> in keyword </td>
          <td> <input type="checkbox" name="do_abstract" checked="checked"> in abstract </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> type </td>
          <td> <input type="checkbox" name="do_bachelor" checked="checked"> Bc. </td>
          <td> <input type="checkbox" name="do_master" checked="checked"> master </td>
          <td> <input type="checkbox" name="do_dr" checked="checked"> dr. </td>
          <td> <input type="checkbox" name="do_phd" checked="checked"> PhD. </td>
          <td> <input type="checkbox" name="do_doc" checked="checked"> doc. </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> grade </td>
          <td> <input type="checkbox" name="do_a" checked="checked"> A </td>
          <td> <input type="checkbox" name="do_b" checked="checked"> B </td>
          <td> <input type="checkbox" name="do_c" checked="checked"> C </td>
          <td> <input type="checkbox" name="do_d" checked="checked"> D </td>
          <td> <input type="checkbox" name="do_e" checked="checked"> E </td>
          <td> <input type="checkbox" name="do_f" checked="checked"> F </td>
          <td> <input type="checkbox" name="do_grade_unknown" checked="checked"> N/A </td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> language </td>
          <td> <input type="checkbox" name="do_cs" checked="checked"> cs </td>
          <td> <input type="checkbox" name="do_sk" checked="checked"> sk </td>
          <td> <input type="checkbox" name="do_en" checked="checked"> en </td>
          <td> <input type="checkbox" name="do_lang_unknown" checked="checked"> N/A </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td>faculty </td>
          <td> <input type="checkbox" name="do_mff_cuni" checked="checked"> MFF CUNI </td>
          <td> <input type="checkbox" name="do_fit_ctu" checked="checked"> FIT CTU </td>
          <td> <input type="checkbox" name="do_fi_muni" checked="checked"> FI MUNI </td>
          <td> <input type="checkbox" name="do_felk_ctu" checked="checked"> FELK CTU </td>
          <td> <input type="checkbox" name="do_fit_vut" checked="checked"> FIT BUT </td>
          <td> <input type="checkbox" name="do_fei_vsb" checked="checked"> FEI VSB </td>
          <td> <input type="checkbox" name="do_fai_utb" checked="checked"> FAI UTB </td>
          <td> <input type="checkbox" name="do_pef_mendelu" checked="checked"> PEF MEND </td>
          <td> <input type="checkbox" name="do_uc" checked="checked"> UC </td>
          <td> <input type="checkbox" name="do_faculty_other" checked="checked"> other </td>
        </tr>

        <tr>
          <td> city </td>
          <td> <input type="checkbox" name="do_praha" checked="checked"> Praha </td>
          <td> <input type="checkbox" name="do_brno" checked="checked"> Brno </td>
          <td> <input type="checkbox" name="do_ostrava" checked="checked"> Ostrava </td>
          <td> <input type="checkbox" name="do_zlin" checked="checked"> Zlin </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> other </td>
          <td> <input type="checkbox" name="do_fulltext" checked="checked"> fulltext </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td> year </td>
          <td colspan="2"> year from: <input type="number" value="1990"> </td>
          <td colspan="2"> year to: <input type="number" value="2020"> </td>
          <td> <input type="checkbox" name="do_year_unknown" checked="checked"> unknown </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>

        <tr>
          <td colspan="11"> <input class="search" type="button" value="search" onclick="search_clicked()"> </td>
        </tr>
      </table>
    </form>

    <table id="thesis_list">
    </table>

  </body>

</html>
